process test={
    service = MessageLogger {
	untracked vstring destinations = { "cout" }
	untracked PSet cout = { untracked string threshold = "DEBUG" }
	untracked vstring debugModules   = { "*" }
    }
    untracked PSet maxEvents = {untracked int32 input = 1}
    
    ############ File Input ############
    source = PoolSource {
	untracked vstring fileNames =  {"castor:/castor/cern.ch/user/g/giordano/run8055_171_onlyDIGI.root"}
    }
    
    ## CABLING
    include "CalibTracker/Configuration/data/SiStrip_FrontierCabling.cfi"
    replace siStripFedCabling.toGet={ { string record = "SiStripFedCablingRcd" string tag = "SiStripCabling_pass4_test_v1"} }
    #replace siStripFedCabling.connect = "oracle://cms_orcoff_int2r/CMS_COND_STRIP"
    replace siStripFedCabling.connect = "frontier://FrontierDev/CMS_COND_STRIP"
    
    ## PEDESTALS
    include "CalibTracker/Configuration/data/SiStrip_FrontierPedestals.cfi"
    replace siStripPedestals.toGet={   { string record = "SiStripPedestalsRcd"  string tag = "SiStripPedestals_pass4_test_v1_p"}  }
    #replace siStripPedestals.connect = "oracle://cms_orcoff_int2r/CMS_COND_STRIP"
    replace siStripPedestals.connect = "frontier://FrontierDev/CMS_COND_STRIP"
    
    ## NOISE
    include "CalibTracker/Configuration/data/SiStrip_FrontierNoise.cfi"
    replace siStripNoise.toGet={ { string record = "SiStripNoisesRcd"     string tag = "SiStripNoises_pass4_test_v1_n"} }
    #replace siStripNoise.connect = "oracle://cms_orcoff_int2r/CMS_COND_STRIP"
    replace siStripNoise.connect = "frontier://FrontierDev/CMS_COND_STRIP"
    
    ## GAIN
    include "CalibTracker/Configuration/data/SiStrip_FakeGain.cfi"

    ## REAL CONDITIONS
    ## GAIN
    # include "CalibTracker/Configuration/data/SiStrip_FrontierGain.cfi"
    #    replace siStripApvGain.toGet={
    #        { string record = "SiStripApvGainRcd" string tag = "SiStripApvGain_TickMarksfromASCII_TBuffer_v1" } }
    #    replace siStripApvGain.connect = "frontier://FrontierDev/CMS_COND_STRIP"
    
    ## SiStripQuality
    
    ## REAL SiStripQuality
    es_source siStripBadModules = PoolDBESSource {
	string appendToDataLabel = "SiStripBadModule_v1"
	VPSet toGet = { 
	    { string record = "SiStripBadModuleRcd"  string tag = "SiStripBadModule_TBuffer_VenturiList_v1"} }
	string connect = "frontier://FrontierDev/CMS_COND_STRIP"
	string timetype = "runnumber"
	untracked string BlobStreamerName="TBufferBlobStreamingService"  
	PSet DBParameters = {
	    untracked string authenticationPath = ""
	}     
    }
    
    es_source siStripBadFibers = PoolDBESSource {
	string appendToDataLabel = "SiStripBadFiber_v1"
	VPSet toGet = {
	    { string record = "SiStripBadFiberRcd"   string tag = "SiStripBadFiber_TBuffer_VenturiList_v1"} }
	string connect = "frontier://FrontierDev/CMS_COND_STRIP"
	string timetype = "runnumber"
	untracked string BlobStreamerName="TBufferBlobStreamingService"
	PSet DBParameters = {
	    untracked string authenticationPath = ""
	}
    }
 
    #REAL SISTRIPQUALITY   
    #es_module = SiStripQualityESProducer {
    #	string appendToDataLabel = ""
    #	VPSet ListOfRecordToMerge = {
    #	    { string record = "SiStripBadModuleRcd"  string tag = "SiStripBadModule_v1"} ,
    #	    { string record = "SiStripBadFiberRcd"   string tag = "SiStripBadFiber_v1"}#,
    #	    #{ string record = "SiStripDetCablingRcd" string tag = ""}
    #	}
    #    }
    
    # FAKE
    include "CalibTracker/SiStripESProducers/data/SiStripQualityFakeESSource.cfi"
    
    
    ############ Digitization ############
    include "EventFilter/SiStripRawToDigi/data/SiStripDigis.cfi"
    replace SiStripDigis.ProductLabel="source"
    
    # ZeroSuppression
    include "RecoLocalTracker/SiStripZeroSuppression/data/SiStripZeroSuppression.cfi"
    
    
    ############ Cluster Reconstruction ############
    include "RecoLocalTracker/SiStripClusterizer/data/SiStripClusterizer_RealData.cfi"
    replace siStripClusters.ChannelThreshold    = 2.0
    replace siStripClusters.SeedThreshold       = 3.0
    replace siStripClusters.ClusterThreshold    = 5.0
    
    
    ############# track reconstruction sequence and output  #############
    module out = PoolOutputModule {
	untracked string fileName = "/tmp/giordano/run8055_.root"
	
	untracked vstring outputCommands = {
	    #"keep *"
	    "drop *",
	    "keep *_siStripClusters_*_*"
	} 
    
    } 
    
    
    sequence digitization   = {SiStripDigis,siStripZeroSuppression}
    path p = { 
	#digitization,
	siStripClusters
    } 
    
    endpath e = {out}

}
