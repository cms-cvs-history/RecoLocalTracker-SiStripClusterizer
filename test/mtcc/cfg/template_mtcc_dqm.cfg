
process ReadRUFile = {

service = MessageLogger {
	untracked vstring destinations = { "insert_logpath/dqm_insert_outputfilename.log" }
	untracked PSet dqm_insert_outputfilename.log = { string threshold = "ERROR" PSet default = { int32 limit = -1 bool noLineBreaks = false } }

}

#service = Tracer {}
#service = Timing { }

#Geometry
include "Geometry/CMSCommonData/data/cmsMTCCGeometryXML.cfi"

es_module = TrackerGeometricDetESModule {}
es_module = TrackerDigiGeometryESModule {}

#Magnetic Field
#
include "MagneticField/Engine/data/volumeBasedMagneticField.cfi"


es_source = PoolDBESSource { 
              VPSet toGet = {
                { string record = "SiStripPedestalsRcd"
                  string tag = "SiStripPedestals_v1"
                }
               ,{ string record = "SiStripNoisesRcd"
                  string tag = "SiStripNoises_v1"
                } 
              }
              bool loadAll = true
              string connect = "sqlite_file:insert_SiStripPedNoisesDB"
	      untracked string catalog = "file:insert_SiStripPedNoisesCatalog" 
              string timetype = "runnumber" 
              untracked bool loadBlobStreamer = true

	      untracked uint32 authenticationMethod = 0
              untracked uint32 messagelevel = 3
            }


#read cabling from ascii file
##186 es_source = SiStripFedCablingFromXml {
##186	string Label="Fed1"
##186	string XmlParsedFile="insert_fedconnection_description"
##186 }

#read cabling from db
##p5  include "OnlineDB/SiStripESSources/data/BuildFedCablingUsingConfigDb.cfi"
##p5	  replace BuildFedCablingUsingConfigDb.UsingDb = true
##p5	  replace BuildFedCablingUsingConfigDb.User = "cms_mtcc_sitracker"
##p5	  replace BuildFedCablingUsingConfigDb.Passwd = "cms_mtcc"
##p5	  replace BuildFedCablingUsingConfigDb.Path = "omds"
##p5	  replace BuildFedCablingUsingConfigDb.Partition = "MTCC_TEST4"
##p5   


#input source
##LocalDAQ  include "IORawData/SiStripInputSources/data/TBRUInputSource.cfi"
##LocalDAQ 	  replace TBRUInputSource.fileNames = { insert_input_filenames }
##LocalDAQ	  replace TBRUInputSource.maxEvents =-1 //@@ all events
##LocalDAQ	  replace TBRUInputSource.TriggerFedId = 53

##GlobalDAQ  source = PoolSource
##GlobalDAQ  {
##GlobalDAQ    untracked vstring fileNames = { insert_input_filenames }
##GlobalDAQ    untracked int32 maxEvents = -1
##GlobalDAQ    untracked uint32 debugVebosity = 1
##GlobalDAQ    untracked bool   debugFlag     = true
##GlobalDAQ  }


module RawToDigi = SiStripRawToDigiModule 
{
        string InputModuleLabel = "source"
	untracked int32 AppendedBytes = 0
       	untracked int32 FedBufferDumpFreq = 0
       	untracked bool  UseFedKey = false
       	untracked int32 TriggerFedId = 1023
}


# include SiStripZeroSuppression module
include "RecoLocalTracker/SiStripZeroSuppression/data/SiStripZeroSuppression.cfi"

# include SiStripClusterizer module
include "RecoLocalTracker/SiStripClusterizer/data/SiStripClusterizer_RealData.cfi"
	replace	ThreeThresholdClusterizer.ChannelThreshold    = 3.0
	replace	ThreeThresholdClusterizer.SeedThreshold       = 4.0
	replace	ThreeThresholdClusterizer.ClusterThreshold    = 5.0

#include "RecoLocalTracker/SiStripRecHitConverter/data/StripCPEfromTrackAngle.cfi"
#include "RecoLocalTracker/SiStripRecHitConverter/data/SiStripRecHitConverter.cfi"

# Trigger
     module trigger = MTCCHLTrigger
     {
       bool SelOnDigiCharge=false
       int32 ChargeThreshold=180 # threshold must be larger for collisions (23000 or so for 156 modules selected)
       string  ClusterProducer = "ThreeThresholdClusterizer"
       bool OutputMEsInRootFile = true
     }



// -- DQM --------------------------------------------------------------------------------

// produce SiStripFecCabling and SiStripDetCabling out of SiStripFedCabling
       es_module sistripconn = SiStripConnectivity {}
       service = DaqMonitorROOTBackEnd{}

    # can comment out MonitorDeamon if you want to run without DQMCollector
#    include "DQM/SiStripMonitorCluster/data/MonitorDaemon.cfi"

    # SiStripMonitorDigi
    include "DQM/SiStripMonitorDigi/data/SiStripMonitorDigi_RealData.cfi"
    # use the following flag to select all detectors (e.g. for mtcc data). by default is false
    replace SiStripMonitorDigi.SelectAllDetectors = true

    # SiStripMonitorCluster
    include "DQM/SiStripMonitorCluster/data/SiStripMonitorCluster.cfi"
    # use the following flag to select all detectors (e.g. for mtcc data). by default is false
    replace SiStripMonitorCluster.SelectAllDetectors = true
    replace SiStripMonitorCluster.OutputMEsInRootFile = true
    replace SiStripMonitorCluster.OutputFileName="insert_outputpath/insert_dqmhistos_file.root"

# Trigger Monitoring, SiStripMonitorHLT
    include "DQM/SiStripMonitorCluster/data/SiStripMonitorHLT.cfi"

// -- DQM --------------------------------------------------------------------------------

################# Schedule
    # reconstruction
    path pdigitize_clusterize    = {RawToDigi,theSiStripZeroSuppression,ThreeThresholdClusterizer}
    # digi and cluster monitoring only the ones that pass the hlt
    path pdqm                    = {trigger,SiStripMonitorDigi,SiStripMonitorCluster}
    # monitor for every event the trigger decision
    path phltdqm                 = {SiStripMonitorHLT}
}
#
