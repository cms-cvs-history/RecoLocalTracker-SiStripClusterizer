process ReadRUFile = {

service = MessageLogger {
	untracked vstring destinations = { "insert_logpath/event_dqm_insert_outputfilename.log", "insert_logpath/error_dqm_insert_outputfilename.log", "insert_logpath/debug_dqm_insert_outputfilename.log" }
	untracked PSet error_dqm_insert_outputfilename.log = { string threshold = "ERROR" PSet default = { int32 limit = 11 bool noLineBreaks = false } }
	untracked PSet event_dqm_insert_outputfilename.log = { string threshold = "INFO"    PSet default = { int32 limit = -1 bool noLineBreaks = false } }
	untracked PSet debug_dqm_insert_outputfilename.log = { string threshold = "DEBUG"   PSet default = { int32 limit = -1 bool noLineBreaks = false } }
#	vstring debugModules = { "*" } //@@ uncomment this line for debug statements!
}

#service = Tracer {}
#service = Timing { }

#Geometry
include "Geometry/CMSCommonData/data/cmsMTCCGeometryXML.cfi"

es_module = TrackerGeometricDetESModule {}
es_module = TrackerDigiGeometryESModule {}

#Magnetic Field
#
include "MagneticField/Engine/data/volumeBasedMagneticField.cfi"

es_source = PoolDBESSource { 
              VPSet toGet = {
                { string record = "SiStripPedestalsRcd"
                  string tag = "SiStripPedestals_v1"
                }
               ,{ string record = "SiStripNoisesRcd"
                  string tag = "SiStripNoises_v1"
                }
              }
              bool loadAll = true
              string connect = "sqlite_file:insert_SiStripPedNoisesDB"
              untracked string catalog = "file:insert_SiStripPedNoisesCatalog" 
              string timetype = "runnumber" 
              untracked uint32 authenticationMethod = 0
              untracked uint32 messagelevel = 0
            }


es_source = SiStripFedCablingFromXml {
	string Label="Fed1"
	string XmlParsedFile="insert_fedconnection_description"
}

source = TBRUInputSource
{
	untracked vstring fileNames = { insert_input_filenames }
	untracked int32 maxEvents = -1 //@@ all events
	#untracked int32 nFeds = 1 # not strictly necessary
}

module RawToDigi = SiStripRawToDigiModule 
{
	string InputModuleLabel = "TBRUInputSource"
	untracked int32 AppendedBytes = 0
       	untracked int32 FedBufferDumpFreq = 0
       	untracked bool  UseFedKey = false
       	untracked int32 TriggerFedId = 1023
}

module  theSiStripZeroSuppression =  SiStripZeroSuppression {
	string RawDigiProducer = "RawToDigi"

	string ZeroSuppressionMode  = "SiStripFedZeroSuppression"
	uint32 FEDalgorithm  = 4
	string CommonModeNoiseSubtractionMode = "Median"

        bool UseCalibDataFromDB    = true
	untracked string userEnv   = "me"
	untracked string passwdEnv = "me"

        double ElectronPerAdc      = 313.0 
	double EquivalentNoiseCharge300um = 2160.
	double BadStripProbability = 0.002
	uint32  PedestalValue	   = 30
	double  LowThValue         =  2
	double  HighThValue        =  5
}

module ThreeThresholdClusterizer =  SiStripClusterizer {
    untracked int32 VerbosityLevel = 0

           VPSet DigiProducersList = {
#                { string DigiProducer = "stripdigi"
#                  string DigiLabel    = "\0"
#                },
                { string DigiProducer = "RawToDigi"
                  string DigiLabel    = "ZeroSuppressed"
                },
                { string DigiProducer = "theSiStripZeroSuppression"
                  string DigiLabel    = "fromVirginRaw"
                },
                { string DigiProducer = "theSiStripZeroSuppression"
                  string DigiLabel    = "fromProcessedRaw"
                },
                { string DigiProducer = "theSiStripZeroSuppression"
                  string DigiLabel    = "fromScopeMode"
                }
              }	
	untracked string userEnv   = "me"
	untracked string passwdEnv = "me"
           bool UseCalibDataFromDB = true

	string ClusterMode         = "ThreeThresholdClusterizer"
	double ChannelThreshold    = 2.0
	double SeedThreshold       = 3.0
	double ClusterThreshold    = 5.0
	 int32 MaxHolesInCluster   = 0	

        double ElectronPerAdc      = 313.0 
	double EquivalentNoiseCharge300um = 2160.
	double BadStripProbability = 0.0
}


#include "RecoLocalTracker/SiStripRecHitConverter/data/StripCPEfromTrackAngle.cfi"
#include "RecoLocalTracker/SiStripRecHitConverter/data/SiStripRecHitConverter.cfi"

// -- DQM --------------------------------------------------------------------------------

// produce SiStripFecCabling and SiStripDetCabling out of SiStripFedCabling
       es_module sistripconn = SiStripConnectivity {}
       service = DaqMonitorROOTBackEnd{}

    # can comment out MonitorDeamon if you want to run without DQMCollector
#    include "DQM/SiStripMonitorCluster/data/MonitorDaemon.cfi"

    # SiStripMonitorDigi
    include "DQM/SiStripMonitorDigi/data/SiStripMonitorDigi_RealData.cfi"
    # use the following flag to select all detectors (e.g. for mtcc data). by default is false
    replace SiStripMonitorDigi.SelectAllDetectors = true

    # SiStripMonitorCluster
    include "DQM/SiStripMonitorCluster/data/SiStripMonitorCluster.cfi"
    # use the following flag to select all detectors (e.g. for mtcc data). by default is false
    replace SiStripMonitorCluster.SelectAllDetectors = true
    replace SiStripMonitorCluster.OutputFileName="insert_outputpath/insert_dqmhistos_file.root"

// -- DQM --------------------------------------------------------------------------------

module PoolOutput = PoolOutputModule 
{ 
	untracked string fileName = "insert_outputpath/insert_outputfilename.root" 
	#untracked vstring outputCommands = { "keep *" } //@@ necessary?
}

path p = { 
		RawToDigi, 
		theSiStripZeroSuppression,
		ThreeThresholdClusterizer,
                SiStripMonitorDigi,
                SiStripMonitorCluster
	 }

#endpath e = { PoolOutput}

}

